<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="Instagram Clone - A full-featured social media application"
    />
    <meta name="theme-color" content="#000000" />
    <link
      rel="manifest"
      href="{{ url_for('static', filename='manifest.json') }}"
    />
    <title>{% block title %}Instagram{% endblock %}</title>

    {# Instagram Theme CSS #}
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='instagram-theme.css') }}"
    />

    <style>
      /* Additional template-specific styles */
      .notification-badge-container {
          position: relative;
      }

      .hashtag-link {
          color: var(--ig-link);
          text-decoration: none;
      }

      .hashtag-link:hover {
          text-decoration: underline;
      }

      /* Layout adjustments */
      {% if current_user.is_authenticated %}
      main {
          padding-top: 0;
      }
      {% endif %}

      @media (max-width: 768px) {
          body {
              padding-bottom: 4rem; /* Bottom nav space */
          }
      }

      /* Feed container styling */
      .feed-container {
          max-width: 614px;
          margin: 0 auto;
      }
    </style>
    {% block extra_css %}{% endblock %}
  </head>
  <body>
    {# Navbar #} {% include 'components/layout/navbar.html' %} {# Sidebar
    removed - Instagram doesn't use sidebar #} {# Main Content #}
    <main class="min-h-screen">
      {# Flash Messages #} {% with messages =
      get_flashed_messages(with_categories=true) %} {% if messages %}
      <div class="flash-messages">
        {% for category, message in messages %}
        <div class="flash flash-{{ category }}">{{ message }}</div>
        {% endfor %}
      </div>
      {% endif %} {% endwith %} {% block content %}{% endblock %}
    </main>

    {# Bottom Navigation (Mobile only) #} {% if current_user.is_authenticated %}
    {% include 'components/layout/bottom_navigation.html' %} {% endif %} {#
    Toast Container #} {% include 'components/common/toast.html' %} {# App
    Utilities #}
    <script src="{{ url_for('static', filename='app-utils.js') }}"></script>
    {# Legacy Scripts #}
    <script src="{{ url_for('static', filename='neon-interactions.js') }}"></script>

    {# Service Worker Registration #}
    <script>
      if ("serviceWorker" in navigator) {
        window.addEventListener("load", () => {
          navigator.serviceWorker
            .register('{{ url_for("static", filename="service-worker.js") }}')
            .then((registration) => {
              console.log("Service Worker registered:", registration.scope);
            })
            .catch((error) => {
              console.log("Service Worker registration failed:", error);
            });
        });
      }
    </script>

    {# Auto-show flash messages as toasts #} {% with messages =
    get_flashed_messages(with_categories=true) %} {% if messages %}
    <script>
      document.addEventListener('DOMContentLoaded', function() {
          {% for category, message in messages %}
          setTimeout(() => {
              if (typeof showToast === 'function') {
                  showToast('{{ message }}', '{{ category }}');
              }
          }, {{ loop.index0 * 500 }});
          {% endfor %}
      });
    </script>
    {% endif %} {% endwith %} {% block extra_js %}{% endblock %}
  </body>
</html>
